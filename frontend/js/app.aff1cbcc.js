(function(t){function e(e){for(var r,i,c=e[0],s=e[1],u=e[2],d=0,h=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&h.push(n[i][0]),n[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);l&&l(e);while(h.length)h.shift()();return o.push.apply(o,u||[]),a()}function a(){for(var t,e=0;e<o.length;e++){for(var a=o[e],r=!0,c=1;c<a.length;c++){var s=a[c];0!==n[s]&&(r=!1)}r&&(o.splice(e--,1),t=i(i.s=a[0]))}return t}var r={},n={app:0},o=[];function i(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=r,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(a,r,function(e){return t[e]}.bind(null,r));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var u=0;u<c.length;u++)e(c[u]);var l=s;o.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},1:function(t,e){},2728:function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e),a.d(e,"API_ENDPOINT",(function(){return K})),a.d(e,"TILE_ENDPOINT",(function(){return W})),a.d(e,"getTileUrl",(function(){return tt}));a("744f"),a("6c7b"),a("7514"),a("20d6"),a("1c4c"),a("6762"),a("cadf"),a("e804"),a("55dd"),a("d04f"),a("c8ce"),a("217b"),a("7f7f"),a("f400"),a("7f25"),a("536b"),a("d9ab"),a("f9ab"),a("32d7"),a("25c9"),a("9f3c"),a("042e"),a("c7c6"),a("f4ff"),a("049f"),a("7872"),a("a69f"),a("0b21"),a("6c1a"),a("c7c62"),a("84b4"),a("c5f6"),a("2e37"),a("fca0"),a("7cdf"),a("ee1d"),a("b1b1"),a("87f3"),a("9278"),a("5df2"),a("04ff"),a("f751"),a("4504"),a("fee7"),a("ffc1"),a("0d6d"),a("9986"),a("8e6e"),a("25db"),a("e4f7"),a("b9a1"),a("64d5"),a("9aea"),a("db97"),a("66c8"),a("57f0"),a("165b"),a("456d"),a("cf6a"),a("fd24"),a("8615"),a("551c"),a("097d"),a("df1b"),a("2397"),a("88ca"),a("ba16"),a("d185"),a("ebde"),a("2d34"),a("f6b3"),a("2251"),a("c698"),a("a19f"),a("9253"),a("9275"),a("3b2b"),a("3846"),a("4917"),a("a481"),a("28a5"),a("386d"),a("6b54"),a("4f7f"),a("8a81"),a("ac4d"),a("8449"),a("9c86"),a("fa83"),a("48c0"),a("a032"),a("aef6"),a("d263"),a("6c37"),a("9ec8"),a("5695"),a("2fdb"),a("d0b0"),a("5df3"),a("b54a"),a("f576"),a("ed50"),a("788d"),a("14b9"),a("f386"),a("f559"),a("1448"),a("673e"),a("242a"),a("c66f"),a("b05c"),a("34ef"),a("6aa2"),a("15ac"),a("af56"),a("b6e4"),a("9c29"),a("63d9"),a("4dda"),a("10ad"),a("c02b"),a("4795"),a("130f"),a("ac6a"),a("96cf");var r=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[!1===t.authToken?a("LoginView",{on:{authenticated:function(e){t.authToken=e}}}):a("router-view",{on:{error:function(e){t.authToken=!1}}})],1)},o=[],i=(a("ab8b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d-flex justify-content-center align-items-center container",staticStyle:{height:"80vh"}},[a("div",{staticClass:"col-md-6 align-self-center"},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-body"},[a("h5",{staticClass:"card-title"},[t._v("Enter Login and Password")]),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.login,expression:"login"}],staticClass:"form-control",attrs:{type:"text",id:"login",placeholder:"Enter login"},domProps:{value:t.login},on:{input:function(e){e.target.composing||(t.login=e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"form-control",attrs:{type:"password",id:"password",placeholder:"Password"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),a("button",{staticClass:"btn btn-primary",on:{click:t.performAuth}},[t._v("Submit")])])])])])}),c=[],s={name:"LoginView",data:function(){return{login:"",password:""}},methods:{performAuth:function(){this.login.length>0&&this.password.length>0&&this.$emit("authenticated",btoa(this.login+":"+this.password))}}},u=s,l=a("2877"),d=Object(l["a"])(u,i,c,!1,null,"5f2baca5",null),h=d.exports,f={name:"App",components:{LoginView:h},data:function(){return{authenticated:!1,authToken:!1}},mounted:function(){localStorage.authToken&&(this.authToken=localStorage.authToken)},watch:{authToken:function(t){localStorage.authToken=t,r["a"].http.headers.common["Authorization"]="Basic "+t}}},p=f,m=Object(l["a"])(p,n,o,!1,null,"69fa62fa",null),v=m.exports,g=a("28dd"),y=a("8c4f"),b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{ref:"map",staticClass:"map"}),a("div",{staticClass:"control-panel card"},[a("div",{staticClass:"card-body"},[a("div",{staticClass:"form-group"},[a("div",{staticClass:"form-check"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.showGridCoordinates,expression:"showGridCoordinates"}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"check-grid-coords"},domProps:{checked:Array.isArray(t.showGridCoordinates)?t._i(t.showGridCoordinates,null)>-1:t.showGridCoordinates},on:{change:function(e){var a=t.showGridCoordinates,r=e.target,n=!!r.checked;if(Array.isArray(a)){var o=null,i=t._i(a,o);r.checked?i<0&&(t.showGridCoordinates=a.concat([o])):i>-1&&(t.showGridCoordinates=a.slice(0,i).concat(a.slice(i+1)))}else t.showGridCoordinates=n}}}),a("label",{staticClass:"form-check-label",attrs:{for:"check-grid-coords"}},[t._v("Show grid coordinates")])]),a("button",{staticClass:"btn btn-secondary",staticStyle:{"margin-top":"10px"},attrs:{type:"button"},on:{click:t.zoomOut}},[t._v("Zoom\n                    out\n                ")])]),a("div",{staticClass:"form-group"},[a("label",[t._v("Jump to Quest Giver")]),a("model-select",{attrs:{options:t.questGivers,placeholder:"Select Quest Giver"},model:{value:t.selectedMarker,callback:function(e){t.selectedMarker=e},expression:"selectedMarker"}})],1),a("div",{staticClass:"form-group"},[a("label",[t._v("Jump to Player")]),a("model-select",{attrs:{options:t.players,placeholder:"Select Player"},model:{value:t.zz,callback:function(e){t.zz=e},expression:"zz"}})],1)])])])},k=[],w=a("0393"),C=a("e11e"),x=a.n(C),j=100,L=6,E=1,I=x.a.GridLayer.extend({displayGridCoordinates:!1,createTile:function(t){var e=document.createElement("div");e.width=j,e.height=j,e.classList.add("map-tile");var a=Math.pow(2,L-t.z),r={x:t.x*a,y:t.y*a},n={x:r.x+a-1,y:r.y+a-1},o=document.createElement("img");o.width=o.height=j-1,o.style.display="none",o.id="grid_".concat(t.x,"_").concat(t.y),e.appendChild(o);var i=new Image;i.onload=function(){o.src=i.src,o.style.display="block",o.classList.remove("load-error")},i.onerror=function(){o.classList.add("load-error")},i.src=tt(r.x,r.y,t.z);var c="(".concat(r.x,";").concat(r.y,")");1!==a&&(c+="<br>(".concat(n.x,";").concat(n.y,")"));var s=document.createElement("div");return s.classList.add("map-tile-text"),s.innerHTML=c,s.style.display=this.displayGridCoordinates?"block":"none",e.appendChild(s),e},showGridCoordinates:function(t){this.displayGridCoordinates=t;var e=t?"block":"none";document.querySelectorAll(".map-tile-text").forEach((function(t){return t.style.display=e}))},reloadTilesAround:function(t){var e={};t.forEach((function(t){for(var a=-1;a<=1;a++)for(var r=-1;r<=1;r++){var n={x:t.x+a,y:t.y+r};e["".concat(n.x,"_").concat(n.y)]=n}})),Object.values(e).forEach((function(t){var e=document.getElementById("grid_".concat(t.x,"_").concat(t.y));if(e&&e.classList.contains("load-error")){var a=new Image;a.onload=function(){e.src=a.src,e.style.display="block",e.classList.remove("load-error")},a.src=tt(t.x,t.y,L)}}))}}),_=x.a.Icon.extend({options:{iconSize:[32,32],iconAnchor:[16,16]}}),T=90*j/25e5,z=180*j/25e5,O={project:function(t){return new C["Point"](t.lat/T,t.lng/z)},unproject:function(t){return new C["LatLng"](t.x*T,t.y*z)},bounds:function(){return new C["Bounds"]([-T,-z],[T,z])}()},$=x.a.extend({},x.a.CRS.Simple,{projection:O});function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function P(t,e,a){return e&&M(t.prototype,e),a&&M(t,a),t}function S(t){return"gfx/invobjs/small/bush"===t||"gfx/invobjs/small/bumling"===t?"quest":"custom"===t?"custom":t.substring("gfx/terobjs/mm/".length)}var A=function(){function t(e){G(this,t),this.id=e.id,this.position=e.position,this.name=e.name,this.image=e.image,this.type=S(this.image),this.marker=!1,this.text=this.name,this.value=this.id}return P(t,[{key:"remove",value:function(t){this.marker&&t.removeLayer(this.marker)}},{key:"add",value:function(t){var e=new _({iconUrl:"/".concat(this.image,".png")}),a=t.unproject([this.position.x,this.position.y],L);this.marker=C["marker"](a,{icon:e,title:this.name}),this.marker.addTo(t)}},{key:"jumpTo",value:function(t){if(this.marker){var e=t.unproject([this.position.x,this.position.y],L);this.marker.setLatLng(e)}}},{key:"setClickCallback",value:function(t){this.marker&&this.marker.on("click",t)}}]),t}();function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function q(t,e,a){return e&&Z(t.prototype,e),a&&Z(t,a),t}var N=function(){function t(){V(this,t),this.elements={}}return q(t,[{key:"update",value:function(t,e,a,r){var n=this,o=t.filter((function(t){return void 0===n.elements[t.id]})),i=Object.keys(this.elements).filter((function(e){return void 0===t.find((function(t){return""+t.id===e}))})).map((function(t){return n.elements[t]}));a&&i.forEach((function(t){return a(t)})),r&&t.forEach((function(t){var e=n.elements[t.id];e&&r(e,t)})),e&&o.forEach((function(t){return e(t)})),i.forEach((function(t){return delete n.elements[t.id]})),o.forEach((function(t){return n.elements[t.id]=t}))}},{key:"getElements",value:function(){return Object.values(this.elements)}},{key:"byId",value:function(t){return this.elements[t]}}]),t}();function J(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function D(t,e,a){return e&&B(t.prototype,e),a&&B(t,a),t}var X=function(){function t(e){J(this,t),this.name=e.name,this.position=e.position,this.type=e.type,this.id=e.id,this.marker=!1,this.text=this.name,this.value=this.id}return D(t,[{key:"getId",value:function(){return"".concat(this.name)}},{key:"remove",value:function(t){this.marker&&t.removeLayer(this.marker)}},{key:"add",value:function(t){var e=t.unproject([this.position.x,this.position.y],L);this.marker=C["marker"](e,{title:this.name}),this.marker.addTo(t)}},{key:"update",value:function(t,e){if(this.marker){var a=t.unproject([e.position.x,e.position.y],L);this.marker.setLatLng(a)}}},{key:"setClickCallback",value:function(t){this.marker&&this.marker.on("click",t)}}]),t}(),Y={name:"MapView",components:{ModelSelect:w["ModelSelect"]},data:function(){return{showGridCoordinates:!1,trackingCharacterId:-1,autoMode:!1,polling:null,zz:!1,markersCache:[],questGivers:[],players:[],selectedMarker:{value:!1}}},watch:{showGridCoordinates:function(t){this.layer.showGridCoordinates(t)},trackingCharacterId:function(t){if(-1!==t){var e=this.characters.byId(t);e?(this.map.setView(e.marker.getLatLng(),L),this.$router.push({path:"/character/".concat(t)}),this.autoMode=!0):(this.map.setView([0,0],E),this.$router.replace({path:"/grid/0/0/".concat(E)}),this.trackingCharacterId=-1)}},selectedMarker:function(t){t&&this.map.setView(t.marker.getLatLng(),this.map.getZoom())}},mounted:function(){var t=this;this.$http.get("".concat(K,"/v1/characters")).then((function(e){t.setupMap(e.body)}),(function(){return t.$emit("error")}))},beforeDestroy:function(){clearInterval(this.intervalId)},methods:{setupMap:function(t){var e=this;if(this.map=C["map"](this.$refs.map,{minZoom:E,maxZoom:L,crs:$,attributionControl:!1,inertia:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}),this.map.on("drag",(function(){var t=e.map.project(e.map.getCenter(),e.map.getZoom()),a={x:~~(t.x/j),y:~~(t.y/j),z:e.map.getZoom()};e.$router.replace({path:"/grid/".concat(a.x,"/").concat(a.y,"/").concat(a.z)}),e.trackingCharacterId=-1})),this.map.on("zoom",(function(){if(e.autoMode)e.autoMode=!1;else{var t=e.map.project(e.map.getCenter(),e.map.getZoom()),a={x:~~(t.x/j),y:~~(t.y/j),z:e.map.getZoom()};e.$router.replace({path:"/grid/".concat(a.x,"/").concat(a.y,"/").concat(a.z)}),e.trackingCharacterId=-1}})),this.layer=new I({tileSize:j}),this.layer.addTo(this.map),this.markers=new N,this.characters=new N,this.updateCharacters(t),this.$route.params.characterId)this.trackingCharacterId=+this.$route.params.characterId;else if(this.$route.params.gridX&&this.$route.params.gridY&&this.$route.params.zoom){var a=this.toLatLng(100*this.$route.params.gridX,100*this.$route.params.gridY);this.map.setView(a,this.$route.params.zoom)}else this.map.setView([0,0],E);this.intervalId=setInterval((function(){e.$http.get("".concat(K,"/v1/characters")).then((function(t){e.updateCharacters(t.body)}),(function(){clearInterval(e.intervalId),e.$emit("error")}))}),2e3),this.$http.get("".concat(K,"/v1/markers")).then((function(t){e.updateMarkers(t.body)}),(function(){e.$emit("error")}))},updateMarkers:function(t){var e=this;this.markers.update(t.map((function(t){return new A(t)})),(function(t){t.add(e.map),t.setClickCallback((function(){e.map.setView(t.marker.getLatLng(),L)}))}),(function(t){t.remove(e.map)})),this.markersCache.length=0,this.markers.getElements().forEach((function(t){return e.markersCache.push(t)})),this.questGivers.length=0,this.markersCache.filter((function(t){return"quest"===t.type})).forEach((function(t){return e.questGivers.push(t)}))},updateCharacters:function(t){var e=this;this.characters.update(t.map((function(t){return new X(t)})),(function(t){t.add(e.map),t.setClickCallback((function(){e.trackingCharacterId=t.id}))}),(function(t){t.remove(e.map)}),(function(t,a){t.update(e.map,a),e.trackingCharacterId==a.id&&e.map.setView(t.marker.getLatLng(),L)})),this.players.length=0,this.characters.getElements().forEach((function(t){return e.players.push(t)}))},toLatLng:function(t,e){return this.map.unproject([t,e],L)},zoomOut:function(){this.trackingCharacterId=-1,this.map.setView([0,0],E)}}},Q=Y,U=(a("8ff2"),Object(l["a"])(Q,b,k,!1,null,null,null)),H=U.exports;r["a"].use(y["a"]);var R=new y["a"]({routes:[{path:"/",component:H},{path:"/character/:characterId",component:H},{path:"/grid/:gridX/:gridY/:zoom",component:H}]}),F="",K="".concat(F,"/api"),W="".concat(F);function tt(t,e,a){return"".concat(W,"/grids/").concat(L-a,"/").concat(t,"_").concat(e,".png")}r["a"].config.productionTip=!1,r["a"].use(g["a"]),new r["a"]({router:R,render:function(t){return t(v)}}).$mount("#app")},"8ff2":function(t,e,a){"use strict";var r=a("2728"),n=a.n(r);n.a}});
//# sourceMappingURL=app.aff1cbcc.js.map